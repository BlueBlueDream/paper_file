<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
    <title>BlueBorne 蓝牙漏洞深入分析与 PoC（超详细） | MottoIN</title>
    <link rel='dns-prefetch' href='//www.mottoin.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="MottoIN &raquo; BlueBorne 蓝牙漏洞深入分析与 PoC（超详细）评论Feed" href="http://www.mottoin.com/106262.html/feed" />
<link rel='stylesheet' id='stylesheet-css'  href='http://www.mottoin.com/wp-content/themes/JustNews/css/style.css?ver=2.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpcom-qa-css'  href='http://www.mottoin.com/wp-content/plugins/wpcom-qa/css/style.css?ver=1.0' type='text/css' media='all' />
<style id='wpcom-qa-inline-css' type='text/css'>

        .q-content .topic-tab,.q-content .q-answer .as-user,.q-content .q-answer .as-comment-name{color: #1471CA;}
        .q-content .q-topic-wrap a:hover,.q-content .q-answer .as-action a:hover,.q-content .topic-tab:hover{color:#0D62B3;}
        .q-content .put-top,.q-content .topic-tab.current-tab,.q-content .q-answer .as-submit .btn-submit,.q-content .q-answer .as-comments-submit,.q-content .q-add-header .btn-post,.q-content .q-pagination .current{background-color:#1471CA;}
        .q-content .q-answer .as-submit .btn-submit:hover,.q-content .q-answer .as-comments-submit:hover,.q-content .q-add-header .btn-post:hover,.q-content .topic-tab.current-tab:hover,.q-content .q-pagination a:hover{background-color:#0D62B3;}
        .q-content .q-answer .as-comments-input:focus{border-color: #1471CA;}
        
</style>
<link rel='stylesheet' id='um_minified-css'  href='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/css/um.min.css?ver=10.3.88' type='text/css' media='all' />
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/jquery.min.js?ver=1.12.4'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.mottoin.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.mottoin.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='借势Taboola投放恶意广告，新型“技术支持诈骗”防不胜防' href='http://www.mottoin.com/106247.html' />
<link rel='shortlink' href='http://www.mottoin.com/?p=106262' />
<!--  WPCOM主题相关信息开始 -->
<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform">
<meta name="keywords" content="360Vulpecker Team,armis,BlueBorne,蓝牙漏洞">
<meta name="description" content="0x00前情提要前些天，armis爆出了一系列蓝牙的漏洞，无接触无感知接管系统的能力有点可怕，而且基本上影响所有的蓝牙设备，危害不可估量，可以看这里（https://www[.]armis[.]com/blueborne/ ）来了解一下它的逆天能力：只要手机开启了蓝牙，就可能被远程控制。现在手机这么多，利用这个漏洞写出蠕虫化的工具，那么可能又是一个手机版的低配wannacry了。我们360Vulp">
<!--  WPCOM主题相关信息结束 -->
 
		<script type="text/javascript">

		var ultimatemember_image_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-image-upload.php';
		var ultimatemember_file_upload_url = 'http://www.mottoin.com/wp-content/plugins/ultimate-member/core/lib/upload/um-file-upload.php';
		var ultimatemember_ajax_url = 'http://www.mottoin.com/wp-admin/admin-ajax.php';

		</script>

	
		<style type="text/css">.request_name { display: none !important; }</style>

	<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-32x32.jpg" sizes="32x32" />
<link rel="icon" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-192x192.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-180x180.jpg" />
<meta name="msapplication-TileImage" content="http://www.mottoin.com/wp-content/uploads/2016/12/cropped-Avatar-270x270.jpg" />
    <style>
                a,.sec-panel-head span,.list.tabs .tab.active a,.header .nav>li.active>a,.header .dropdown-menu>.active>a,.entry .entry-info .nickname,.entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.comment-body .nickname,.form-submit-text span,.widget_profile .author-title,.um .um-profile-body .um-item-meta a,.login-modal-body .btn-register{color: #08c;}
        .header .dropdown-menu>li>a:hover,.header .dropdown-menu>.active>a:hover,.header .dropdown-menu>.active>a:focus,.navbar-action .publish,.pagination .current,.flex-control-paging li a.flex-active,.form-submit .submit,.sidebar .widget_nav_menu ul li.current-menu-item a,.sidebar .widget_nav_menu ul li.current-post-parent a,.search-form input.submit,.action .contact-title,.pf-submit,.tagHandler ul.tagHandlerContainer li.tagItem,.login-modal-body .btn-login,.woocommerce a.button,.woocommerce button.button,.woocommerce input.button,.woocommerce a.button.alt,.woocommerce button.button.alt,.woocommerce input.button.alt,.woocommerce a.button.alt.disabled,.woocommerce a.button.alt.disabled:hover,.woocommerce a.button.alt:disabled,.woocommerce a.button.alt:disabled:hover,.woocommerce a.button.alt:disabled[disabled],.woocommerce a.button.alt:disabled[disabled]:hover,.woocommerce button.button.alt.disabled,.woocommerce button.button.alt.disabled:hover,.woocommerce button.button.alt:disabled,.woocommerce button.button.alt:disabled:hover,.woocommerce button.button.alt:disabled[disabled],.woocommerce button.button.alt:disabled[disabled]:hover,.woocommerce input.button.alt.disabled,.woocommerce input.button.alt.disabled:hover,.woocommerce input.button.alt:disabled,.woocommerce input.button.alt:disabled:hover,.woocommerce input.button.alt:disabled[disabled],.woocommerce input.button.alt:disabled[disabled]:hover,.woocommerce .widget_price_filter .ui-slider .ui-slider-handle,.woocommerce .widget_price_filter .ui-slider .ui-slider-range,.shopping-count,.social-login-form .sl-input-submit{background-color: #08c;}
        .entry .entry-content h3,.entry .entry-content .h3,.widget-title{border-left-color: #08c;}
        .entry-bar-inner .author-title,.entry-action .btn-zan,.entry-action .btn-dashang,.search-form input.keyword:focus,.widget_profile .author-title,.login-modal-body .btn-login,.login-modal-body .btn-register{border-color: #08c;}
        .entry-bar-inner .author-title:before,.widget_profile .author-title:before{border-right-color: #08c;}
        .list.tabs .tab.active a{border-bottom-color: #08c;}

        a:hover,.header .nav>li>a:hover,.header .nav>li.active>a,.navbar-action .login:hover,.navbar-action .login:focus,.navbar-action .profile a:hover,.navbar-search-icon:hover,.navbar-search-icon:focus,.entry .entry-info a:hover,.entry .entry-info a:focus,.entry-bar .info-item a:hover,.p-item-wrap:hover .title a,.special-item-title a:hover,.special-item-bottom a:hover,.widget ul a:hover,.widget ol a:hover,.sec-panel-head .more:hover,.topic-list .topic-wrap:hover span,.tabs .tab a:hover,
        .article-list .item-title a:hover,.article-list .item-meta a:hover,.article-list .item-meta a:focus,.list-links a:hover,.list-links a:focus,.um .um-profile-body .um-item-meta a:hover,.um .um-profile-body .um-item-link a:hover,.load-more:hover,.login-modal-body .btn-register:hover{color: #07c;}
        .navbar-action .publish:hover,.navbar-action .publish:focus,.entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.pagination a:hover,.flex-control-paging li a:hover,.form-submit .submit:hover,.widget .tagcloud a:hover,.sidebar .widget_nav_menu ul li.current-menu-item .sub-menu a:hover,.sidebar .widget_nav_menu ul li.current-post-parent .sub-menu a:hover,.sidebar .widget_nav_menu ul li a:hover,.search-form input.submit:hover,.action .a-box:hover,.footer-sns .fa:after,.article-list .item-category:hover,.pf-submit:hover,.tagHandler ul.tagHandlerContainer li.tagItem:hover,.login-modal-body .btn-login:hover,.woocommerce a.button:hover,.woocommerce button.button:hover,.woocommerce input.button:hover,.woocommerce a.button.alt:hover,.woocommerce button.button.alt:hover,.woocommerce input.button.alt:hover,.woocommerce .widget_price_filter .price_slider_wrapper .ui-widget-content,.social-login-form .sl-input-submit:hover{background-color: #07c;}
        .entry-tag a:hover,.entry-tag a:focus,.entry-action .btn-zan:hover,.entry-action .btn-dashang:hover,.entry-action .btn-zan.liked,.widget .tagcloud a:hover,.load-more:hover,.login-modal-body .btn-login:hover,.login-modal-body .btn-register:hover{border-color: #07c;}
        .special-item-bottom a:hover:before{border-left-color: #07c;}
        .list.tabs .tab.active a:hover{border-bottom-color: #07c;}
        @media (max-width: 991px){
            .header .navbar-nav>li.active>a,.header .navbar-nav .dropdown-menu .active a,.header .navbar-nav .dropdown-menu .active .dropdown-menu .active a{color: #08c;}
            .navbar-collapse{background-color: #08c;}
            .dropdown-menu>li a{border-color: #07c;}
            .header .navbar-nav>li.active>a:hover,.header .navbar-nav>li a:hover,.header .navbar-nav .dropdown-menu .active a:hover,.header .navbar-nav .dropdown-menu .active .dropdown-menu a:hover,.header .navbar-nav .dropdown-menu li a:hover{color: #07c;}
        }
        .j-share{position: fixed!important;top: 50%!important;}
                .header .logo img{max-height: 32px;}
                @media (max-width: 767px){
            .header .logo img{max-height: 26px;}
        }
                        .btn-post{
    display: block;
    margin: 0 auto;
    padding: 15px 20px;
    font-size: 16px;
    text-align: center;
    color: #fff !important;
    line-height: 1;
    background: #1471CA;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    text-decoration: none;
    border: 0;
    outline: 0;
}    </style>
    <script> (function() {if (!/*@cc_on!@*/0) return;var e = "abbr, article, aside, audio, canvas, datalist, details, dialog, eventsource, figure, footer, header, hgroup, mark, menu, meter, nav, output, progress, section, time, video".split(', ');var i= e.length; while (i--){ document.createElement(e[i]) } })()</script>
    <!--[if lte IE 8]><script src="http://www.mottoin.com/wp-content/themes/JustNews/js/respond.min.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-106262 single-format-standard">
<header class="header">
    <div class="container clearfix">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar icon-bar-1"></span>
                <span class="icon-bar icon-bar-2"></span>
                <span class="icon-bar icon-bar-3"></span>
            </button>
            <a class="logo" href="http://www.mottoin.com"><img src="http://www.mottoin.com/img/mottoin/logo.png" alt="MottoIN"></a>
        </div>
        <div class="collapse navbar-collapse">
            <nav class="navbar-left primary-menu"><ul id="menu-%e5%af%bc%e8%88%aa" class="nav navbar-nav"><li class="menu-item menu-item-home"><a href="http://www.mottoin.com/">首页</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/news">资讯</a></li>
<li class="menu-item dropdown"><a href="http://www.mottoin.com/category/article" class="dropdown-toggle">文章</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/web">Web安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/system">系统安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/network">网络安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/terminal">终端安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/database">数据安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/wireless">无线安全</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/social">社会工程</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/intranet">内网渗透</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/code">代码审计</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/article/reverse">逆向破解</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/tools">工具</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/category/geek">极客</a></li>
<li class="menu-item dropdown"><a href="http://www.mottoin.com/category/sole" class="dropdown-toggle">独家</a>
<ul role="menu" class=" dropdown-menu">
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/topic">专题</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/people">人物</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/view">观点</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/events">活动</a></li>
	<li class="menu-item"><a href="http://www.mottoin.com/category/sole/video">视频</a></li>
</ul>
</li>
<li class="menu-item"><a href="http://www.mottoin.com/category/hr">招聘</a></li>
<li class="menu-item"><a href="http://www.mottoin.com/forum">社区</a></li>
</ul></nav>            <div class="navbar-action pull-right">

                                    <form class="navbar-search" action="http://www.mottoin.com" method="get" role="search">
                        <input type="text" name="s" class="navbar-search-input" autocomplete="off" placeholder="输入关键词搜索..." value="">
                        <a class="navbar-search-icon j-navbar-search" href="javascript:;"></a>
                    </form>

                    
                    <div id="j-user-wrap">
                        <a class="login" href="http://www.mottoin.com/login">登录</a>
                        <a class="login" href="http://www.mottoin.com/register">注册</a>
                    </div>
                    <a class="publish" href="http://www.mottoin.com/post">
                        投稿</a>
                                                </div>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</header>
<div id="wrap">    <div class="main container">
        <div class="content">
                            <article id="post-106262" class="post-106262 post type-post status-publish format-standard hentry category-1948 tag-360vulpecker-team tag-armis tag-blueborne tag-4018">
                    <div class="entry">
                        <div class="entry-head">
                            <h1 class="entry-title">BlueBorne 蓝牙漏洞深入分析与 PoC（超详细）</h1>
                            <div class="entry-info">
                                                                <a class="nickname" href="http://www.mottoin.com/user/360/">360安全</a>
                                <span class="dot">•</span>
                                <span>1小时前</span>
                                <span class="dot">•</span>
                                <a href="http://www.mottoin.com/category/%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90" rel="category tag">漏洞分析</a>                                                                    <span class="dot">•</span>
                                    <span>阅读 21</span>
                                                            </div>
                        </div>
                                                                        <div class="entry-content clearfix">
                            <p><img class="aligncenter wp-image-106263 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1226.jpeg" alt="" width="450" height="275" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1226.jpeg 1134w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1226-300x183.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1226-768x469.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1226-1024x625.jpeg 1024w" sizes="(max-width: 450px) 100vw, 450px" /></p>
<h3><strong>0x00 前情提要<br />
</strong></h3>
<p>前些天，armis爆出了一系列蓝牙的漏洞，<strong>无接触无感知接管系统</strong>的能力有点可怕，而且基本上影响所有的蓝牙设备，危害不可估量，可以看这里（<a href="https://www.armis.com/blueborne/">https://www[.]armis[.]com/blueborne/</a>  ）来了解一下它的逆天能力：只要手机开启了蓝牙，就可能被远程控制。现在手机这么多，利用这个漏洞写出蠕虫化的工具，那么可能又是一个手机版的低配wannacry了。我们360Vulpecker Team在了解到这些相关信息后，快速进行了跟进分析。 armis给出了他们的whitepaper，对蓝牙架构和这几个漏洞的分析可以说非常详尽了，先膜一发。不过他们没有给出这些漏洞的PoC或者是exp，只给了一个针对Android的“BlueBorne检测app&#8221;，但是逆向这个发现<strong>仅仅是检测了系统的补丁日期</strong>。于是我来拾一波牙慧，把这几个漏洞再分析一下，然后把poc编写出来：</p>
<ul>
<li>
<blockquote><p>CVE-2017-1000250 Linux bluetoothd进程信息泄露</p></blockquote>
</li>
<li>
<blockquote><p>CVE-2017-1000251 Linux 内核栈溢出</p></blockquote>
</li>
<li>
<blockquote><p>CVE-2017-0785 Android com.android.bluetooth进程信息泄露</p></blockquote>
</li>
<li>
<blockquote><p>CVE-2017-0781 Android com.android.bluetooth进程堆溢出</p></blockquote>
</li>
<li>
<blockquote><p>CVE-2017-0782 Android com.android.bluetooth进程堆溢出</p></blockquote>
</li>
</ul>
<p><strong>以上PoC</strong><strong>代码均在</strong></p>
<p><a href="https://github.com/marsyy/littl_tools/tree/master/bluetooth"><strong>https://github[.]com/marsyy/littl_tools/tree/master/bluetooth</strong></a><strong> </strong></p>
<p>由于也是因为这几个漏洞才从零开始搞蓝牙，所以应该有些分析不到位的地方，还请各路大牛斧正。</p>
<h3><strong>0x01 </strong><strong>蓝牙架构及代码分布</strong></h3>
<p>这里首先应该祭出armis的paper里的图：</p>
<p><img class="aligncenter wp-image-106264 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1227.jpeg" alt="" width="600" height="568" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1227.jpeg 1222w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1227-300x284.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1227-768x727.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1227-1024x969.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>图上把蓝牙的各个层次关系描述得很详尽，不过我们这里暂时只需要关心这么几层：<strong>HCI</strong><strong>，L2CAP</strong><strong>，BNEP</strong><strong>，SDP</strong>。BNEP和SDP是比较上层的服务，HCI在最底层，直接和蓝牙设备打交道。而承载在蓝牙服务和底层设备之间的桥梁，也就是L2CAP层了。每一层都有它协议规定的数据组织结构，所有层的数据包组合在一起，就是一个完整的蓝牙包（一个SDP包为例）：</p>
<p><img class="aligncenter wp-image-106266 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12281506749932_.pic_.jpg" alt="" width="600" height="267" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12281506749932_.pic_.jpg 1210w, http://www.mottoin.com/wp-content/uploads/2017/09/12281506749932_.pic_-300x133.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12281506749932_.pic_-768x341.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12281506749932_.pic_-1024x455.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>虽然协议规定的架构是图上说的那样，但是具体实现是有不同的，Linux用的<strong>BlueZ</strong>，而现在的Android用的<strong>BlueDroid</strong>，也就针对这两种架构说一说代码的具体分布。</p>
<p><span style="color: #0000ff;"><strong>BlueZ</strong></span></p>
<p>在Linux里，用的是BlueZ架构，由<strong>bluetoothd</strong>来提供BNEP,SDP这些比较上层的服务，而L2CAP层则是放在内核里面。对于BlueZ我们对SDP和L2CAP挨个分析。</p>
<ul>
<li>实现SDP服务的代码在代码目录的<strong>/src/sdp</strong>，其中<strong>sdp-client.c</strong>是它的客户端，<strong>sdp-server.c</strong>是它的服务端。我们要分析的漏洞都是远程的漏洞，所以<strong>问题是出在服务端里面</strong>，我们重点关注服务端。而服务端最核心的代码，应该是它对接受到的数据包的处理的过程，这个过程由<strong>sdp-request.c</strong>来实现。当L2CAP层有SDP数据后，会触发sdp-server.c的<strong>io_session_event</strong>函数，来获取这个数据包，交由<strong>sdp-request.c</strong>的<strong>handle_request</strong>函数处理(怎么处理的，后续漏洞分析的时候再讲)：</li>
</ul>
<p><img class="aligncenter wp-image-106268 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1264.jpeg" alt="" width="600" height="381" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1264.jpeg 1710w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1264-300x191.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1264-768x488.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1264-1024x650.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<ul>
<li>L2CAP层的代码在内核里，这里我以Linux 4.2.8这份代码为例。l2cap层主要由<strong> /net/bluetooth/l2capcore.c</strong>和<strong>/net/bluetooth/l2cap_sock.c</strong>来实现。<strong>l2cap_core.c</strong>实现了L2CAP协议的主要内容，l2cap_sock.c通过注册sock协议的方式提供了这一层针对userspace的接口。同样的我们关心一个L2CAP对接受到数据包后的处理过程，L2CAP的数据是由HCI层传过来的，在hci_core.c的hci_rx_work函数里</li>
</ul>
<p><img class="aligncenter wp-image-106270 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1265.jpeg" alt="" width="600" height="531" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1265.jpeg 1706w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1265-300x266.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1265-768x680.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1265-1024x906.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>收到数据后，会判断pkt_type，符合L2CAP层的type是<strong>HCI_ACLDATA_PKT</strong>，函数会走到<strong>hci_acldata_packet</strong>，这个函数会把HCI的数据剥离之后，把L2CAP数据交给L2CAP层的<strong>l2cap_recv_acldata</strong>：</p>
<p><img class="aligncenter wp-image-106271 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1266.jpeg" alt="" width="600" height="325" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1266.jpeg 1702w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1266-300x163.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1266-768x416.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1266-1024x555.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>同样的，对于L2CAP层对数据的细致处理，我们还是等后续和漏洞来一块进行分析。</p>
<p><span style="color: #0000ff;"><strong>BlueDroid</strong></span></p>
<p>在现在的Android里，用的是<strong>BlueDroid</strong>架构。这个和BlueZ架构有很大不同的一点是：<strong>BlueDroid</strong><strong>将L2CAP</strong><strong>层放在了userspace</strong>。SDP，BNEP，L2CAP统统都由<strong>com.android.bluetooth</strong>这个进程管理。而BlueDroid代码的核心目录在Android源码目录下的 <strong>/sytem/bt</strong> ，这个目录的核心产物是<strong>bluetooth.default.so</strong>，这个so集成所有Android蓝牙相关的服务，而且这个so没有导出任何相关接口函数，只导出了几个协议相关的全局变量供使用，所以想根据so来本地检测本机是否有BlueDrone漏洞，是一件比较困难的事情。对于BlueDroid，由于android的几个漏洞出在BNEP服务和SDP服务，所以也就主要就针对这两块。值得注意的是，在Android里，<strong>不论是</strong><strong>64</strong><strong>位还是32</strong><strong>位的系统，这个bluetooth.default.so</strong><strong>都是用的32</strong><strong>位的</strong>。文章里这部分代码都基于<strong>Android7.1.2</strong>的源码。</p>
<p><strong>1</strong><strong>，BlueDroid</strong><strong>的SDP</strong><strong>服务的代码，在/system/bt/stack/sdp </strong><strong>文件夹里，其中sdp</strong><strong>服务端对数据包的处理由sdp-server.c</strong><strong>实现</strong>。SDP连接建立起来后，在收到SDP数据包之后呢，会触发回调函数sdp_data_ind，这个函数会把数据包交个<strong>sdp-server.c</strong>的sdp_server_handle_client_req函数进行处理:</p>
<p><strong><img class="aligncenter wp-image-106272 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1267.jpeg" alt="" width="600" height="259" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1267.jpeg 1708w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1267-300x130.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1267-768x332.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1267-1024x442.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></strong></p>
<p><strong>BlueDroid</strong><strong>的BNEP</strong><strong>服务的代码主要在/system/bt/stack/bnep/bnepmain.c</strong>。BNEP连接建立起来后，再收到BNEP的包，和SDP类似，会触发回调函数bnep_data_ind，这个函数包含了所有对BNEP请求的处理，漏洞也是发生在这里，具体的代码我们后续会分析。</p>
<h3><strong>0x02 </strong><strong>漏洞分析以及PoC</strong><strong>写法</strong></h3>
<p>蓝牙的预备知识差不多了，主要是找数据包的入口。我们再基于漏洞和PoC的编写过程来详细分析其中的处理过程，和相关蓝牙操作的代码该怎么写。</p>
<p><span style="color: #0000ff;"><strong>CVE-2017-1000251</strong></span></p>
<p>这个是Linux L2CAP层的漏洞，那么就是内核里面的。先不着急看漏洞，先看L2CAP层如何工作。在一个L2CAP连接的过程中，我们抓取了它的数据包来分析，L2CAP是怎么建立起连接的：</p>
<p><img class="aligncenter wp-image-106273 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12331506749964_.pic_.jpg" alt="" width="600" height="178" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12331506749964_.pic_.jpg 1600w, http://www.mottoin.com/wp-content/uploads/2017/09/12331506749964_.pic_-300x89.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12331506749964_.pic_-768x228.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12331506749964_.pic_-1024x303.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>我们注意这么几个包： <strong>sent_infomation_request , send_connection_request, send_configure_request</strong>。抓包可以看到，在一次完整的L2CAP连接的建立过程中，发起连接的机器，会主动送出这么几个包。其中infomation_request是为了得到对方机器的名称等信息，connection_request是为了建立L2CAP真正的连接，主要是为了确定双方的CHANNEL ID，后续的数据包传输都要跟着这个channel id 走（图上的SCID, DCID），这个channel也就是我们所说的连接。在connection_request处理完毕之后，连接状态将变成 BT_CONNECT2 。随后机器会发起configure_request,这一步就到了armis的paper第十页所说的configuration  process:</p>
<p><img class="aligncenter wp-image-106274 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12341506749970_.pic_.jpg" alt="" width="600" height="404" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12341506749970_.pic_.jpg 1600w, http://www.mottoin.com/wp-content/uploads/2017/09/12341506749970_.pic_-300x202.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12341506749970_.pic_-768x517.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12341506749970_.pic_-1024x689.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>这个过程完成后，整个L2CAP层的连接也就建立完成。</p>
<p>从上述过程看，可以发现L2CAP层连接的建立，主要是对上述三个请求的发起和处理。而我们的漏洞，也其实就发生在configuration  process。我们先分析接收端收到这三个请求后，处理的逻辑在哪里，也就是我们前文提到的L2CAP对接受到的数据的处理过程：</p>
<p>1，在l2cap_recv_acldata接收到数据后，数据包会传给l2cap_recv_frame</p>
<p>2，l2cap_recv_frame会取出检查L2CAP的头部数据，然后检查根据头部里的cid字段，来选择处理逻辑：</p>
<p><img class="aligncenter wp-image-106275 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1268.jpeg" alt="" width="600" height="465" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1268.jpeg 1710w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1268-300x233.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1268-768x596.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1268-1024x794.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>3，底层L2CAP的连接，cid固定是L2CAP_CID_SIGNALING，于是会走l2cap_sig_channel，l2cap_sig_channel得到的是剥离了头部的L2CAP的数据，这一部将把数据里的cmd头部解析并剥离，再传给l2cap_bredr_sig_cmd进行处理：</p>
<p><img class="aligncenter wp-image-106276 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1269.jpeg" alt="" width="600" height="396" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1269.jpeg 1704w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1269-300x198.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1269-768x507.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1269-1024x675.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>到这里，我们应该能得出L2CAP协议的数据结构：</p>
<p><img class="aligncenter wp-image-106277 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12371506749988_.pic_.jpg" alt="" width="600" height="118" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12371506749988_.pic_.jpg 1384w, http://www.mottoin.com/wp-content/uploads/2017/09/12371506749988_.pic_-300x59.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12371506749988_.pic_-768x151.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12371506749988_.pic_-1024x201.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>4， 随后数据进入到了l2cap_bredr_sig_cmd函数进行处理。这里也就是处理L2CAP各种请求的核心函数了：</p>
<p><img class="aligncenter wp-image-106278 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1270.jpeg" alt="" width="600" height="632" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1270.jpeg 1710w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1270-285x300.jpeg 285w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1270-768x809.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1270-972x1024.jpeg 972w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>好了，接下来终于可以分析漏洞了。我们的漏洞发生在对<strong>L2CAP_CONFIG_RSP</strong><strong>（config response</strong><strong>）</strong>这个cmd的处理上。其实漏洞分析armis的paper已经写的很详尽了，我这里也就权当翻译了吧，然后再加点自己的理解。那么来看l2cap_config_rsp:</p>
<p><img class="aligncenter wp-image-106279 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1271.jpeg" alt="" width="600" height="537" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1271.jpeg 1706w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1271-300x269.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1271-768x688.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1271-1024x917.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>当收到的数据包里，满足<strong>result == L2CAP_CONF_PENDING</strong>，且自身的连接状态<strong>conf_state == CONF_LOC_CONF_PEND</strong>的时候，会走到 <strong>l2cap_parse_conf_rsp</strong>函数里，而且传过去的buf是个长度为64的数据，参数len ，参数rsp-&gt;data都是由包中的内容来任意确定。那么在<strong>l2cap_parse_conf_rsp</strong>函数里：</p>
<p><img class="aligncenter wp-image-106280 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1272.jpeg" alt="" width="600" height="903" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1272.jpeg 1288w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1272-199x300.jpeg 199w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1272-768x1156.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1272-681x1024.jpeg 681w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>仔细阅读这个函数的代码可以知道，这个函数的功能就是<strong>根据传进来的包，来构造将要发出去的包</strong>。而数据的出口就是传进去的64字节大小的buf。但是对传入的包的数据的长度并没有做检验，那么当len很大时，就会一直往出口buf里写数据，比如有64个<strong>L2CAP_CONF_MTU</strong>类型的opt，那么就会往buf里写上<strong>64*(L2CAP_CONF_OPT_SIZE + 2)</strong>个字节，那么显然这里就发生了溢出。由于buf是栈上定义的数据结构，那么这里就是一个栈溢出。 不过值得注意的是，代码要走进去，需要<strong>conf_state == CONF_LOC_CONF_PEND</strong>，这个状态是在处理<strong>L2CAP_CONF_REQ</strong>数据包的时候设置的：</p>
<p><img class="aligncenter wp-image-106281 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1273.jpeg" alt="" width="600" height="705" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1273.jpeg 1284w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1273-255x300.jpeg 255w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1273-768x902.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1273-872x1024.jpeg 872w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>当收到L2CAP_CONF_REQ的包中包含有L2CAP_CONF_EFS类型的数据【1】，而且L2CAP_CONF_EFS数据的<strong>stype == L2CAP_SERV_NOTRAFIC</strong>【2】的时候，conf_state会被置CONF_LOC_CONF_PEND</p>
<p>到这里，这个漏洞触发的思路也就清楚了：</p>
<p>1，建立和目标机器的L2CAP 连接，这里注意sock_type的选择要是SOCK_RAW，如果不是，内核会自动帮我们完成sent_infomation_request, send_connection_request, send_configure_request这些操作，也就无法触发目标机器的漏洞了。</p>
<p>2，建立SOCK_RAW连接，connect的时候，会自动完成sent_infomation_request的操作，不过这个不影响。</p>
<p>3，接下来我们需要完成send_connection_request操作，来确定SCID,DCID。完成这个操作的过程是发送合法的 L2CAP_CONN_REQ数据包。</p>
<p>4，接下来需要发送包含有L2CAP_CONF_EFS类型的数据，而且L2CAP_CONF_EFS数据的stype ==L2CAP_SERV_NOTRAFIC的L2CAP_CONF_REQ包，这一步是为了让目标机器的conf_state变成CONF_LOC_CONF_PEND。</p>
<p>5，这里就到了发送cmd_len很长的L2CAP_CONN_RSP包了。这个包的result字段需要是L2CAP_CONF_PENDING。那么这个包发过去之后，目标机器就内核栈溢出了，要么重启了，要么死机了。</p>
<p>这个漏洞是这几个漏洞里，触发最难的。</p>
<p><span style="color: #0000ff;"><strong>CVE-2017-1000250</strong></span></p>
<p>这个漏洞是BlueZ的SDP服务里的信息泄露漏洞。这个不像L2CAP层的连接那么复杂，主要就是上层服务，收到数据就进行处理。那么我们也只需要关注处理的函数。 之前说过，BlueZ的SDP收到数据是从io_session_event开始。之后，数据的流向是：</p>
<table width="620">
<tbody>
<tr>
<td width="19">1</td>
<td><strong>ios_essionevent&#8211;&gt;handlerequest&#8211;&gt;processrequest</strong></td>
</tr>
</tbody>
</table>
<p><img class="aligncenter wp-image-106282 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12451506750034_.pic_.jpg" alt="" width="600" height="189" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12451506750034_.pic_.jpg 1600w, http://www.mottoin.com/wp-content/uploads/2017/09/12451506750034_.pic_-300x95.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12451506750034_.pic_-768x242.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12451506750034_.pic_-1024x323.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>有必要介绍一下SDP协议的数据结构：  它有一个sdp_pud_hdr的头部，头部数据里定义了PUD命令的类型，tid，以及pdu parameter的长度，然后就是具体的parameter。最后一个字段是continuation state，当一个包发不完所要发送的数据的时候，这个字段就会有效。对与这个字段，BlueZ给了它一个定义：</p>
<p><img class="aligncenter wp-image-106283 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1274.jpeg" alt="" width="600" height="140" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1274.jpeg 1704w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1274-300x70.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1274-768x179.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1274-1024x239.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>对于远程的连接，PDU命令类型只能是这三个：SDP_SVC_SEARCH_REQ, SDP_SVC_ATTR_REQ, SDP_SVC_SEARCH_ATTR_REQ。这个漏洞呢，出现在对SDP_SVC_SEARCH_ATTR_REQ命令的处理函数里面 service_search_attr_req 。这个函数有点长，就直接说它干了啥，不贴代码了：</p>
<p>1， extract_des(pdata, data_left, &amp;pattern, &amp;dtd, SDP_TYPE_UUID); 解析service search pattern（对应SDP协议数据结构图）</p>
<p>2，max = getbe16(pdata); 获得Maximu Attribute Byte</p>
<p>3，scanned = extract_des(pdata, data_left, &amp;seq, &amp;dtd, SDP_TYPE_ATTRID);解析Attribute ID list</p>
<p>4，if (sdp_cstate_get(pdata, data_left, &amp;cstate) &lt; 0) ;获取continuation state状态cstate，如果不为0，则将包里的continuation state数据复制给cstate.</p>
<p>漏洞发生在对cstate状态不为0的时候的处理，我们重点看这部分的代码：</p>
<p><img class="aligncenter wp-image-106284 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1275.jpeg" alt="" width="600" height="242" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1275.jpeg 1700w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1275-300x121.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1275-768x310.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1275-1024x413.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>sdp_get_cached_rsp函数其实是对cstate的timestamp值的检验，如何过这个检验之后再说。当代码走到【1】处的memcpy时，由于<strong>cstate-&gt;maxBytesSent</strong>就是由数据包里的数据所控制，而且没有做任何检验，所以这里可以为任意的uint16t值。那么很明显，这里就出现了一个对pResponse的越界读的操作。而越界读的数据还会通过SDP RESPONSE发送给攻击方，那么一个信息泄露就发生了。</p>
<p>写这个poc需要注意sdp_get_cached_rsp的检验的绕过，那么首先需要得到一个timestamp。当一次发送的包不足以发送完所有的数据的时候，会设置cstate状态，所以如果我们发给服务端的包里，max字段非常小，那么服务端就会给我们回应一个带cstate状态的包，这里面会有timestamp:</p>
<p><img class="aligncenter wp-image-106285 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1276.jpeg" alt="" width="600" height="259" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1276.jpeg 1704w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1276-300x130.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1276-768x332.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1276-1024x442.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>所以，我们的poc应该是这个步骤：</p>
<p>1，建立SDP连接。这里我们的socket需要是SOCK_STREAM类型，而且connet的时候，addr的psm字段要是0x0001。关于连接的PSM：</p>
<p><img class="aligncenter wp-image-106286 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12491506750058_.pic_.jpg" alt="" width="600" height="449" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12491506750058_.pic_.jpg 1600w, http://www.mottoin.com/wp-content/uploads/2017/09/12491506750058_.pic_-300x225.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12491506750058_.pic_-768x575.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12491506750058_.pic_-1024x767.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>2，发送一个不带cstate状态的数据包，而且指定Maximu Attribute Byte的值非常小。这一步是为了让服务端给我们返回一个带timestamp的包。</p>
<p>3，接收这个带timestamp的包，并将timestamp提取。</p>
<p>4，发送一个带cstate状态的数据包，cstate的timestamp是指定为提取出来的值，服务端memcpy的时候，则就会把pResponse+maxBytesSent的内容发送给我们，读取这个数据包，则就获取了泄露的数据。</p>
<p><span style="color: #0000ff;"><strong>CVE-2017-0785</strong></span></p>
<p>这个漏洞也是SDP的信息泄露漏洞，不过是BlueDroid的。与BlueZ的那个是有些类似的。我们也从对SDP数据包的处理函数说起。 SDP数据包会通过sdp_data_ind函数送给sdp_server_handle_client_req。与BlueZ一样，这个函数也会根据包中的pud_id来确定具体的处理函数。这个漏洞发生在对SDP_PDU_SERVICE_SEARCH_REQ命令的处理，对包内数据的解析与上文BlueZ中的大同小异，不过注意在BlueDroid中，cstate结构与BlueZ中有些不同：</p>
<p><strong><img class="aligncenter wp-image-106287 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1277.jpeg" alt="" width="605" height="108" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1277.jpeg 1700w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1277-300x54.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1277-768x137.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1277-1024x183.jpeg 1024w" sizes="(max-width: 605px) 100vw, 605px" /></strong></p>
<p>这里主要看漏洞：</p>
<p><img class="aligncenter wp-image-106288 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1278.jpeg" alt="" width="600" height="908" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1278.jpeg 1278w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1278-198x300.jpeg 198w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1278-768x1162.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1278-677x1024.jpeg 677w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>①，②中代码可以看出，变量num_rsp_handles的值，一定程度上可以由包中的Maximu Attribute Byte字段控制。 ③中代码是对带cstate的包的处理，第一步是对大小的检查，第二步是获得cont_offset，然后对cont_offset进行检查，第三步就到了 <strong>rem_handles = num_rsp_handles &#8211; cont_offset</strong>  可以思考一种情况，如果num_rsp_handles &lt; cont_offset，那么这个代码就会发生整数的下溢，而num_rsp_handles在一定程度上我们可以控制，而且是可以控制它变成０，那么只要cont_offset不为０，这里就会发生整数下溢。发生下溢的结果给了rem_handles，而这个变量代表的是还需要发送的数据数。 在④中，如果rem_handles是发生了下溢的结果，由于它是uint16_t类型，那么它将变成一个很大的数，所以会走到<strong>pccb-&gt;cont_offset += cur_handles</strong>;,cur_handles是一个固定的值，那么如果这个下溢的过程，发生很多次，pccb-&gt;cont_offset就会变得很大，那么在５处，就会有一个对rsp_handles数组的越界读的产生。</p>
<p>下面的操作可以让这个越界读发生：</p>
<p>１，发送一个不带cstate的包， 而且Maximu Attribute Byte字段设置的比较大。那么结果就是rem_handles = num_rsp_handles，而由于max_replies比较大，所以<strong>num_rsp_handles</strong>会成为一个比较大的值。只要在④中保证rem_handles&gt; cur_handles，那么pccb-&gt;cont_offset就会成为一个非０值cur_handles。这一步是为了使得pccb-&gt;cont_offset成为一个非０值。</p>
<p>２，接收服务端的回应包，这个回应包里的cstate字段将会含有刚刚的pccb-&gt;cont_offset值，我们取得这个值。</p>
<p>３，发送一个带cstate的包，cont_offset指定为刚刚提取的值，而且设置Maximu Attribute Byte字段为０。那么服务端收到这个包后，就会走到<strong>rem_handles = num_rsp_handles &#8211; cont_offset</strong>从而发生整数下溢，同时pccb-&gt;cont_offset又递增一个cur_handles大小。</p>
<p>４，重复２和３的过程，那么pccb-&gt;cont_offset将越来越大，从而在⑤出发生越界读，我们提取服务端返回的数据，就可以获得泄露的信息的内容。</p>
<p><span style="color: #0000ff;"><strong>CVE-2017-0781</strong></span></p>
<p>现在我们到了BNEP服务。BNEP的协议格式，下面两张图可以说明的很清楚：</p>
<p><img class="aligncenter wp-image-106289 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12531506750081_.pic_.jpg" alt="" width="600" height="127" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12531506750081_.pic_.jpg 1384w, http://www.mottoin.com/wp-content/uploads/2017/09/12531506750081_.pic_-300x63.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12531506750081_.pic_-768x162.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12531506750081_.pic_-1024x216.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><img class="aligncenter wp-image-106290 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12551506750100_.pic_.jpg" alt="" width="600" height="128" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12551506750100_.pic_.jpg 1384w, http://www.mottoin.com/wp-content/uploads/2017/09/12551506750100_.pic_-300x64.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12551506750100_.pic_-768x164.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12551506750100_.pic_-1024x219.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>BlueDroid中BNEP服务对于接受到的数据包的处理也不复杂：</p>
<p>1,解析得到BNEP_TYPE，得到extension位。</p>
<p>2,检查连接状态，如果已经连接则后续可以处理非<strong>BNEP_FRAME_CONTROL</strong>的包，如果没有建立连接，则后续只处理BNEP_FRAME_CONTROL的包。</p>
<p>3,去BNEP_TYPE对应的处理函数进行处理。</p>
<p>4,对于BNEP_TYPE不是BNEP_FRAME_CONTROL而且有extension位的，还需要对extension的数据进行处理。</p>
<p>5,调用pan层的回调函数。</p>
<p>值得注意的是，BNEP连接真正建立起来，需要先处理一个合法的<strong>BNEP_FRAME_CONTROL</strong>数据包。 CVE-2017-0781正是连接还没建立起来，在处理<strong>BNEP_FRAME_CONTROL</strong>时所发生的问题：</p>
<p><img class="aligncenter wp-image-106291 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1279.jpeg" alt="" width="600" height="242" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1279.jpeg 1908w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1279-300x121.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1279-768x309.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1279-1024x412.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>上述代码中，malloc了一个remlen的大小，这个是和收到的数据包的长度相关的。可是memcpy的时候，却是从<strong>pbcb-&gt;p_pending_data</strong><strong>＋１</strong>开始拷贝数据，那么这里会直接溢出一个<strong>sizeof(*(pbcb-&gt;p_pending_data))</strong>大小的内容。这个大小是8.所以只要代码走到这，就会有一个8字节大小的堆溢出。而要走到这，只需要过那个if的判断条件，而这个if其实是对<strong>BNEP_SETUP_CONNECTION_REQUEST_MSG</strong>命令处理失败后的错误处理函数。那么只要发送一个错误的<strong>BNEP_SETUP_CONNECTION_REQUEST_MSG</strong>命令包，就可以进入到这段代码了触发堆溢出了。</p>
<p>所以我们得到poc的编写过程：</p>
<p>１，建立BNEP连接，这个和SDP类似，只是需要指定PSM为BNEP对应的0x000F。</p>
<p>２，发送一个BNEPTYPE为<strong>BNEP_FRAME_CONTROL</strong>，extension字段为１，ctrl_type为<strong>BNEP_SETUP_CONNECTION_REQUEST_MSG</strong>的错误的BNEP包：</p>
<p><img class="aligncenter wp-image-106292 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12571506750111_.pic_.jpg" alt="" width="600" height="95" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12571506750111_.pic_.jpg 1384w, http://www.mottoin.com/wp-content/uploads/2017/09/12571506750111_.pic_-300x48.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12571506750111_.pic_-768x122.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12571506750111_.pic_-1024x163.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p><span style="color: #0000ff;"><strong>CVE-2017-0782</strong></span></p>
<p>这个也是由于BNEP协议引起的漏洞，首先它是个整数溢出，整数溢出导致的后果是堆溢出。 问题出在BNEP对extension字段的处理上：</p>
<p><img class="aligncenter wp-image-106293 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1280.jpeg" alt="" width="600" height="669" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1280.jpeg 1700w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1280-269x300.jpeg 269w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1280-768x857.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1280-918x1024.jpeg 918w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>上述代码中，【１】的ext_len从数据包中获得，没有长度的检查，可为任意值。而当control_type为一个非法值的时候，会走到【２】,那么这里就很有说法了，我们如果设置ext_len比较大，那么这里就会发生一个整数下溢。从而使得rem_len变成一个很大的uint16_t的值。这个值将会影响后续的处理：</p>
<p><img class="aligncenter wp-image-106294 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1281.jpeg" alt="" width="600" height="414" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1281.jpeg 1704w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1281-300x207.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1281-768x530.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1281-1024x707.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>上面的代码中，【１】处将发生整数下溢出，使得rem_len成为一个很大的值（比如0xfffd），【２】处会将这个值赋值给p_buf-&gt;len。【３】处是回调函数处理这个p_buf，在BlueDroid中这个函数是<strong>pan_data_buf_ind_cb</strong>，这个函数会有一条路径调到<strong>bta_pan_data_buf_ind_cback</strong>，而在这个函数中：</p>
<p><img class="aligncenter wp-image-106295 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1282.jpeg" alt="" width="600" height="326" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1282.jpeg 1700w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1282-300x163.jpeg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1282-768x417.jpeg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1282-1024x557.jpeg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>memcpy用到了我们传进来的pbuf，而<strong>pbuf-&gt;len</strong>是刚刚下溢之后的很大的值，所以主要保证<strong>tBTA_PAN_DATA_PARAMS&gt; pbuf-&gt;offset</strong>，这里就会发生一次很大字节的堆溢出。</p>
<p>代码首先要走到extension的处理，这个的前提是连接状态是BNEP_STATE_CONNECTED。而这个状态的建立，需要服务端先接收一个正确的<strong>BNEP_SETUP_CONNECTION_REQUEST_MSG</strong>请求包，同时要想pan_data_buf_ind_cb调用到bta_pan_data_buf_ind_cback产生堆溢出，需要在建立连接的时候指定UUID为<strong>UUID_SERV_CLASS_PANU</strong>可以阅读这两个函数来找到这样做的原因，这里就不再贴代码了。清楚这一点之后，我们就可以构造我们的poc了：</p>
<p>１，建立BNEP连接，这里只是建立起初步的连接，conn_state还不是<strong>BNEP_STATE_CONNECTED</strong>，这一步通过connect实现</p>
<p>２，发送一个正确的<strong>BNEP_SETUP_CONNECTION_REQUEST_MSG</strong>请求包，同时指定UUID为UUID_SERV_CLASS_PANU。这个包将是这样子：</p>
<p><img class="aligncenter wp-image-106296 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12621506750140_.pic_.jpg" alt="" width="600" height="85" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12621506750140_.pic_.jpg 1384w, http://www.mottoin.com/wp-content/uploads/2017/09/12621506750140_.pic_-300x42.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12621506750140_.pic_-768x109.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12621506750140_.pic_-1024x145.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>3，发送一个extension字段可导致整数下溢的包，而且注意控制pbuf-&gt;offset变得比较小：</p>
<p><img class="aligncenter wp-image-106297 j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/12631506750146_.pic_.jpg" alt="" width="600" height="79" data-srcset="http://www.mottoin.com/wp-content/uploads/2017/09/12631506750146_.pic_.jpg 1384w, http://www.mottoin.com/wp-content/uploads/2017/09/12631506750146_.pic_-300x39.jpg 300w, http://www.mottoin.com/wp-content/uploads/2017/09/12631506750146_.pic_-768x101.jpg 768w, http://www.mottoin.com/wp-content/uploads/2017/09/12631506750146_.pic_-1024x135.jpg 1024w" sizes="(max-width: 600px) 100vw, 600px" /></p>
<p>这样PoC就完成了。 <strong>CVE-2017-0781</strong>和<strong>CVE-2017-0782</strong>导致了堆溢出，一般会使得<strong>com.android.bluetooth</strong>崩溃，但是这个进程崩溃系统不会有提醒，需要去logcat来找崩溃的日志。<strong>这是两个很有品质的堆溢出漏洞，结合前面的信息泄露漏洞，是完全可以转化为远程代码执行的。</strong></p>
<h3><strong>0x03 总结<br />
</strong></h3>
<p>这篇分析到这里也就结束了，蓝牙出漏洞是个比较危险的事情，希望没有修补的能尽快修补，补丁链接如下：</p>
<blockquote><p><a href="https://git.kernel.org/pub/scm/bluetooth/bluez.git/commit/?id=9e009647b14e810e06626dde7f1bb9ea3c375d09">CVE-2017-1000250</a></p>
<p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=e860d2c904d1a9f38a24eb44c9f34b8f915a6ea3">CVE-2017-1000251</a></p>
<p><a href="https://android.googlesource.com/platform/system/bt/+/226ea26684d4cd609a5b456d3d2cc762453c2d75">CVE-2017-0785</a></p>
<p><a href="https://android.googlesource.com/platform/system/bt/+/c513a8ff5cfdcc62cc14da354beb1dd22e56be0e">CVE-2017-0781</a></p>
<p><a href="https://android.googlesource.com/platform/system/bt/+/4e47f3db62bab524946c46efe04ed6a2b896b150">CVE-2017-0782</a></p></blockquote>
<p>&nbsp;</p>
<p>确定自己是否有漏洞可以用我们提供的poc呀，关于蓝牙漏洞的研究，也希望能和各位多多交流。</p>
<p><span style="color: #0000ff;"><strong>参考文档</strong></span></p>
<p>1, <a href="https://www.armis.com/blueborne/">https://www[.]armis[.]com/blueborne/</a></p>
<p>2, <a href="http://blog.csdn.net/rain0993/article/details/8533246">http://blog[.]csdn[.]net/rain0993/article/details/8533246</a></p>
<p>3, <a href="https://people.csail.mit.edu/albert/bluez-intro/index.html">https://people[.]csail[.]mit.edu/albert/bluez-intro/index[.]html</a></p>
<h3><strong>0x04 360Vulpecker Team简介<br />
</strong></h3>
<p>360Vulpecker Team: 隶属于360公司信息安全部，致力于保护公司所有Android App及手机的安全，同时专注于移动安全研究，研究重点为安卓APP安全和安卓OEM手机安全。 团队定制了公司内部安卓产品安全开发规范，自主开发并维护了在线Android应用安全审计系统“360显危镜”，在大大提高工作效率的同时也为开发者提供了便捷的安全自测平台。同时研究发现了多个安卓系统上的通用型漏洞，如通用拒绝服务漏洞、“寄生兽”漏洞等，影响范围几乎包括市面上所有应用。 该团队高度活跃在谷歌、三星、华为等各大手机厂商的致谢名单中，挖掘的漏洞屡次获得CVE编号及致谢，在保证360产品安全的前提下，团队不断对外输出安全技术，为移动互联网安全贡献一份力量。</p>
                                                        <div class="entry-copyright"><p>原创文章，作者：360安全，如若转载，请注明出处：http://www.mottoin.com/106262.html</p></div>                        </div>
                        <div class="entry-footer">
                            <div class="entry-tag"><a href="http://www.mottoin.com/tag/360vulpecker-team" rel="tag">360Vulpecker Team</a><a href="http://www.mottoin.com/tag/armis" rel="tag">armis</a><a href="http://www.mottoin.com/tag/blueborne" rel="tag">BlueBorne</a><a href="http://www.mottoin.com/tag/%e8%93%9d%e7%89%99%e6%bc%8f%e6%b4%9e" rel="tag">蓝牙漏洞</a></div>
                            <div class="entry-action">
                                <div class="btn-zan" data-id="106262"><i class="fa fa-thumbs-up"></i> 赞 <span class="entry-action-num">(0)</span></div>

                                
                            </div>
                            <div class="entry-bar">
                                <div class="entry-bar-inner clearfix">
                                                                            <div class="author pull-left">
                                            <a data-user="529" target="_blank" href="http://www.mottoin.com/user/360/" class="avatar">
                                                <img src="http://www.mottoin.com/wp-content/uploads/ultimatemember/529/profile_photo-80.png?1506786314" class="func-um_user gravatar avatar avatar-60 um-avatar um-avatar-uploaded" width="60" height="60" alt="360安全" />                                                360安全                                            </a>
                                            <span class="author-title">企业用户</span>                                         </div>
                                                                        <div class="info pull-right">
                                        <div class="info-item meta">
                                            <a class="meta-item j-heart" href="javascript:;" data-id="106262"><i class="fa fa-heart"></i> <span class="data">0</span></a>
                                            <a class="meta-item" href="#comments"><i class="fa fa-comment"></i> <span class="data">0</span></a>
                                                                                    </div>
                                        <div class="info-item share">
                                            <a class="meta-item" href="javascript:;">
                                                <i class="fa fa-wechat"></i>
                                                <span class="wx-wrap">
                                                    <img src="//pan.baidu.com/share/qrcode?w=320&h=320&url=http://www.mottoin.com/106262.html">
                                                    <span>扫码分享到微信</span>
                                                </span>
                                            </a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=tsina&key=&url=http%3A%2F%2Fwww.mottoin.com%2F106262.html&title=BlueBorne+%E8%93%9D%E7%89%99%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%8E+PoC%EF%BC%88%E8%B6%85%E8%AF%A6%E7%BB%86%EF%BC%89" target="_blank"><i class="fa fa-weibo"></i></a>
                                            <a class="meta-item" href="http://share.baidu.com/s?type=text&searchPic=1&sign=on&to=qzone&key=&url=http%3A%2F%2Fwww.mottoin.com%2F106262.html&title=BlueBorne+%E8%93%9D%E7%89%99%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%8E+PoC%EF%BC%88%E8%B6%85%E8%AF%A6%E7%BB%86%EF%BC%89" target="_blank"><i class="fa fa-qq"></i></a>
                                        </div>
                                        <div class="info-item act">
                                            <a href="javascript:;" id="j-reading"><i class="fa fa-file-text"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                                        <h3 class="entry-related-title">相关推荐</h3><ul class="entry-related clearfix"><li><a href="http://www.mottoin.com/94422.html" title="Joomla 权限提升漏洞（CVE-2016-9838）分析与防御">Joomla 权限提升漏洞（CVE-2016-9838）分析与防御</a></li><li><a href="http://www.mottoin.com/99444.html" title="[CVE-2017-2426]iBook使用JavaScript远程访问漏洞分析">[CVE-2017-2426]iBook使用JavaScript远程访问漏洞分析</a></li><li><a href="http://www.mottoin.com/92324.html" title="一个价值7500刀的CHROME UXSS（CVE-2016-1631）分析与利用">一个价值7500刀的CHROME UXSS（CVE-2016-1631）分析与利用</a></li><li><a href="http://www.mottoin.com/97215.html" title="CVE-2016-2384：针对Linux的BadUSB">CVE-2016-2384：针对Linux的BadUSB</a></li><li><a href="http://www.mottoin.com/95981.html" title="SMBv3远程拒绝服务(BSOD)漏洞分析">SMBv3远程拒绝服务(BSOD)漏洞分析</a></li><li><a href="http://www.mottoin.com/100325.html" title="Microsoft Edge:插件检测">Microsoft Edge:插件检测</a></li><li><a href="http://www.mottoin.com/99237.html" title="漏洞分析：CVE-2017-0475 via ele7enxxh">漏洞分析：CVE-2017-0475 via ele7enxxh</a></li><li><a href="http://www.mottoin.com/100633.html" title="VIDEO CHARGE STUDIO缓冲区溢出漏洞">VIDEO CHARGE STUDIO缓冲区溢出漏洞</a></li><li><a href="http://www.mottoin.com/100479.html" title="CVE-2017-0199：Microsoft Office RTF漏洞分析">CVE-2017-0199：Microsoft Office RTF漏洞分析</a></li><li><a href="http://www.mottoin.com/95256.html" title="Apache Struts远程命令执行（RCE）漏洞分析">Apache Struts远程命令执行（RCE）漏洞分析</a></li></ul>                        </div>
                        
<div id="comments" class="entry-comments">
    	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/106262.html#respond" style="display:none;">取消回复</a></small></h3><div class="comment-form"><div class="comment-must-login">请登录后评论...</div><div class="form-submit"><div class="form-submit-text pull-left"><a href="http://www.mottoin.com/login">登录</a>后才能评论</div> <input name="submit" type="submit" id="must-submit" class="submit" value="发表"></div></div>	</div><!-- #respond -->
		</div><!-- .comments-area -->                    </div>
                </article>
                    </div>
        <aside class="sidebar">
            <div id="profile-3" class="widget widget_profile">                <div class="cover_photo"></div>
                        <div class="avatar-wrap">
                <a target="_blank" href="http://www.mottoin.com/user/360/" class="avatar-link"><img src="http://www.mottoin.com/wp-content/uploads/ultimatemember/529/profile_photo-190.png?1506786314" class="func-um_user gravatar avatar avatar-120 um-avatar um-avatar-uploaded" width="120" height="120" alt="360安全" /></a></div>
            <div class="profile-info">
                <p><span class="author-name">360安全</span><span class="author-title">企业用户</span></p>
                <p class="author-description"></p>
            </div>
            <div class="profile-posts">
                <h3 class="widget-title"><span>最近文章</span></h3>
                <ul>                    <li><a href="http://www.mottoin.com/106262.html" title="BlueBorne 蓝牙漏洞深入分析与 PoC（超详细）">BlueBorne 蓝牙漏洞深入分析与 PoC（超详细）</a></li>
                                    <li><a href="http://www.mottoin.com/106125.html" title="设计师大量文稿遭破坏！国内首例3DMAX病毒“狙击者”爆发">设计师大量文稿遭破坏！国内首例3DMAX病毒“狙击者”爆发</a></li>
                                    <li><a href="http://www.mottoin.com/105952.html" title="供应链幽灵再现–CCleaner软件攻击分析报告">供应链幽灵再现–CCleaner软件攻击分析报告</a></li>
                                    <li><a href="http://www.mottoin.com/105879.html" title="全球首款网络安全概念车驶入上海滩">全球首款网络安全概念车驶入上海滩</a></li>
                                    <li><a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场</a></li>
                </ul>            </div>
            </div><div id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><a class="btn-post" href="/question"><i class="fa fa-edit"></i> 我要提问</a></div></div><div id="post-thumb-3" class="widget widget_post_thumb">            <ul>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106262.html" title="BlueBorne 蓝牙漏洞深入分析与 PoC（超详细）">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1226-480x300.jpeg" width="480" height="300" alt="BlueBorne 蓝牙漏洞深入分析与 PoC（超详细）">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106262.html" title="BlueBorne 蓝牙漏洞深入分析与 PoC（超详细）">BlueBorne 蓝牙漏洞深入分析与 PoC（超详细）</a></p>
                            <p class="item-date">2017年9月30日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106247.html" title="借势Taboola投放恶意广告，新型“技术支持诈骗”防不胜防">
                                    <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="借势Taboola投放恶意广告，新型“技术支持诈骗”防不胜防" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1197-1-480x300.jpeg" />                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106247.html" title="借势Taboola投放恶意广告，新型“技术支持诈骗”防不胜防">借势Taboola投放恶意广告，新型“技术支持诈骗”防不胜防</a></p>
                            <p class="item-date">2017年9月29日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106228.html" title="深入解析技术支持诈骗：钓鱼邮件中暗藏的“花枪”">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1193-480x300.jpeg" width="480" height="300" alt="深入解析技术支持诈骗：钓鱼邮件中暗藏的“花枪”">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106228.html" title="深入解析技术支持诈骗：钓鱼邮件中暗藏的“花枪”">深入解析技术支持诈骗：钓鱼邮件中暗藏的“花枪”</a></p>
                            <p class="item-date">2017年9月29日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106216.html" title="暗网系列之：比特币钱包突然被清空，暗网用户梦断“Dream Market”">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1179-480x300.jpeg" width="480" height="300" alt="暗网系列之：比特币钱包突然被清空，暗网用户梦断“Dream Market”">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106216.html" title="暗网系列之：比特币钱包突然被清空，暗网用户梦断“Dream Market”">暗网系列之：比特币钱包突然被清空，暗网用户梦断“Dream Market”</a></p>
                            <p class="item-date">2017年9月28日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106183.html" title="看我如何逆向分析韩国常见的HWP恶意文件">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1178-480x300.jpeg" width="480" height="300" alt="看我如何逆向分析韩国常见的HWP恶意文件">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106183.html" title="看我如何逆向分析韩国常见的HWP恶意文件">看我如何逆向分析韩国常见的HWP恶意文件</a></p>
                            <p class="item-date">2017年9月27日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106176.html" title="Burp Collaborator：一种DNS隧道利用工具">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1160-480x300.jpeg" width="480" height="300" alt="Burp Collaborator：一种DNS隧道利用工具">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106176.html" title="Burp Collaborator：一种DNS隧道利用工具">Burp Collaborator：一种DNS隧道利用工具</a></p>
                            <p class="item-date">2017年9月27日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106170.html" title="ZNIU：首例利用脏牛漏洞的Android恶意软件 专门瞄准使用中国运营商服务的用户">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1136-480x300.jpeg" width="480" height="300" alt="ZNIU：首例利用脏牛漏洞的Android恶意软件 专门瞄准使用中国运营商服务的用户">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106170.html" title="ZNIU：首例利用脏牛漏洞的Android恶意软件 专门瞄准使用中国运营商服务的用户">ZNIU：首例利用脏牛漏洞的Android恶意软件 专门瞄准使用中国运营商服务的用户</a></p>
                            <p class="item-date">2017年9月27日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106160.html" title="「Threat Hunter」进击之路：如何像攻击者一样思考">
                                    <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="「Threat Hunter」进击之路：如何像攻击者一样思考" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/68078047454004887-480x300.jpg" />                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106160.html" title="「Threat Hunter」进击之路：如何像攻击者一样思考">「Threat Hunter」进击之路：如何像攻击者一样思考</a></p>
                            <p class="item-date">2017年9月26日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106125.html" title="设计师大量文稿遭破坏！国内首例3DMAX病毒“狙击者”爆发">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15064060481-480x300.png" width="480" height="300" alt="设计师大量文稿遭破坏！国内首例3DMAX病毒“狙击者”爆发">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106125.html" title="设计师大量文稿遭破坏！国内首例3DMAX病毒“狙击者”爆发">设计师大量文稿遭破坏！国内首例3DMAX病毒“狙击者”爆发</a></p>
                            <p class="item-date">2017年9月26日</p>
                        </div>
                    </li>
                                    <li class="item">
                                                    <div class="item-img">
                                <a href="http://www.mottoin.com/106119.html" title="德勤全球邮件服务器遭黑客入侵，疑是泄漏大量的客户机密邮件">
                                    <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/10661506395552_.pic_hd-480x300.jpg" width="480" height="300" alt="德勤全球邮件服务器遭黑客入侵，疑是泄漏大量的客户机密邮件">                                </a>
                            </div>
                                                <div class="item-content">
                            <p class="item-title"><a href="http://www.mottoin.com/106119.html" title="德勤全球邮件服务器遭黑客入侵，疑是泄漏大量的客户机密邮件">德勤全球邮件服务器遭黑客入侵，疑是泄漏大量的客户机密邮件</a></p>
                            <p class="item-date">2017年9月26日</p>
                        </div>
                    </li>
                            </ul>
        </div><div id="lastest-products-4" class="widget widget_lastest_products">            <ul class="p-list clearfix">
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/106216.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1179-480x300.jpeg" width="480" height="300" alt="暗网系列之：比特币钱包突然被清空，暗网用户梦断“Dream Market”">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/106216.html" title="暗网系列之：比特币钱包突然被清空，暗网用户梦断“Dream Market”">
                                    暗网系列之：比特币钱包突然被清空，暗网用户梦断“Dream Market”                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/106107.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1033-480x300.jpeg" width="480" height="300" alt="Coinhive迅速成为最受恶意软件开发者喜欢的“门罗币收割机”">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/106107.html" title="Coinhive迅速成为最受恶意软件开发者喜欢的“门罗币收割机”">
                                    Coinhive迅速成为最受恶意软件开发者喜欢的“门罗币收割机”                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/106069.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG221-480x300.jpeg" width="480" height="300" alt="测试发现：只需9分钟，被传播的个人信息就能被恶意利用">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/106069.html" title="测试发现：只需9分钟，被传播的个人信息就能被恶意利用">
                                    测试发现：只需9分钟，被传播的个人信息就能被恶意利用                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/106045.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG1023-480x300.jpeg" width="480" height="300" alt="负责任的漏洞披露(VEP-style)是否有望成为国际准则？">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/106045.html" title="负责任的漏洞披露(VEP-style)是否有望成为国际准则？">
                                    负责任的漏洞披露(VEP-style)是否有望成为国际准则？                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105921.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/170918-Cox-The-Hackers-Hitting-Back-At-Cybercriminals-hero_vkcor5-480x300.gif" width="480" height="300" alt="“黑客反击”的合法化之争">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105921.html" title="“黑客反击”的合法化之争">
                                    “黑客反击”的合法化之争                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105858.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG150-480x300.jpeg" width="480" height="300" alt="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105858.html" title="DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护">
                                    DHS称美国政府不能正确评估 WannaCry 和NotPetya的影响，对企业缺乏适当的保护                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105847.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG141-480x300.jpeg" width="480" height="300" alt="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105847.html" title="国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场">
                                    国家网络安全周开幕 大安全时代360前沿“黑科技”震撼登场                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105799.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="暗网系列之：“入店行窃者”的工具、战术和克星" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/15054708381-150x150-480x300.png" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105799.html" title="暗网系列之：“入店行窃者”的工具、战术和克星">
                                    暗网系列之：“入店行窃者”的工具、战术和克星                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105703.html">
                                <img width="480" height="300" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" class="attachment-post-thumbnail size-post-thumbnail j-lazy wp-post-image" alt="【现场还原】补天漏洞情报发布会记事" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG82-150x150-480x300.jpeg" />                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105703.html" title="【现场还原】补天漏洞情报发布会记事">
                                    【现场还原】补天漏洞情报发布会记事                                </a>
                            </h4>
                        </div>
                    </li>
                                    <li class="col-xs-12 col-md-6 p-item">
                        <div class="p-item-wrap">
                            <a class="thumb" href="http://www.mottoin.com/105692.html">
                                <img class="j-lazy" src="http://www.mottoin.com/wp-content/themes/JustNews/themer/assets/images/lazy.png" data-original="http://www.mottoin.com/wp-content/uploads/2017/09/WechatIMG75-480x300.jpeg" width="480" height="300" alt="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">                            </a>
                            <h4 class="title">
                                <a href="http://www.mottoin.com/105692.html" title="SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼">
                                    SyScan360看点回顾：中美德俄等七国黑客专家神技大比拼                                </a>
                            </h4>
                        </div>
                    </li>
                            </ul>
        </div>        </aside>
    </div>
<div class="modal" id="login-modal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                <h4 class="modal-title">请登录</h4>
            </div>
            <div class="modal-body login-modal-body">
                <p>您还未登录，请登录后再进行相关操作！</p>
                <div class="login-btn">
                    <a class="btn btn-login" href="http://www.mottoin.com/login">登 录</a>
                    <a class="btn btn-register" href="http://www.mottoin.com/register">注 册</a>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<footer class="footer">
    <div class="container">
        <div class="clearfix">
                        <div class="footer-col footer-col-logo">
                <img src="http://www.mottoin.com/img/mottoin/tmxk.png" alt="MottoIN">
            </div>
                        <div class="footer-col footer-col-copy">
                <ul class="footer-nav hidden-xs"><li id="menu-item-104182" class="menu-item menu-item-104182"><a href="http://www.mottoin.com/about">关于我们</a></li>
<li id="menu-item-104181" class="menu-item menu-item-104181"><a href="http://www.mottoin.com/dis">免责声明</a></li>
<li id="menu-item-104183" class="menu-item menu-item-104183"><a href="http://www.mottoin.com/joinus">加入我们</a></li>
<li id="menu-item-105509" class="menu-item menu-item-105509"><a href="http://www.mottoin.com/contact">联系我们</a></li>
<li id="menu-item-104184" class="menu-item menu-item-104184"><a href="http://www.mottoin.com/report">寻求报道</a></li>
<li id="menu-item-104185" class="menu-item menu-item-104185"><a href="http://www.mottoin.com/contribute">我要投稿</a></li>
</ul>                <div class="copyright">
                    Copyright © 2017 MottoIN 版权所有 <a href="http://www.miibeian.gov.cn/">沪ICP备16010654号-5</a>  <img class="alignnone " src="http://www.mottoin.com/img/mottoin/ga.png" width="16" height="16" /> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010402001331">沪公网安备31010402001331号</a>                 </div>
            </div>
            <div class="footer-col footer-col-sns">
                <div class="footer-sns">
                                                                                    <a class="sns-wx" href="javascript:;">
                            <i class="fa fa-weixin"></i>
                            <span style="background-image:url(http://www.mottoin.com/img/mottoin/weixin.jpg);"></span>
                        </a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-weibo"></i></a>
                                                                <a target="_blank" href="http://weibo.com/mottoin" rel="nofollow"><i class="fa fa-tencent-weibo"></i></a>
                                                                                                                                                                                </div>
            </div>
        </div>
    </div>
</footer>
<div class="action" style="top:50%;">
            <div class="a-box contact">
            <div class="contact-wrap">
                <h3 class="contact-title">联系我们</h3>
                <h4 style="text-align: center;"><span style="color: #2d6ded;"><strong>021-62666911</strong></span></h4>
<p>在线咨询：<a href="http://wpa.qq.com/msgrd?uin=19539638" target="_blank" rel="noopener"><img class="alignnone" title="点击这里给我发消息" src="http://wpa.qq.com/pa?p=2:1666839010:51" alt="点击这里给我发消息" border="0" /></a></p>
<p>邮件：root@mottoin.com</p>
<p>工作时间：周一至周五，9:30-18:30，节假日休息</p>
            </div>
        </div>
                <div class="a-box wechat">
            <div class="wechat-wrap">
                <img src="http://www.mottoin.com/img/mottoin/weixin.jpg" alt="QR code">
            </div>
        </div>
            <div class="a-box gotop" id="j-top" style="display: none;"></div>
</div>
<style>.footer{padding-bottom: 35px;}</style><div id="um_upload_single" style="display:none">
	
</div><div id="um_view_photo" style="display:none">

	<a href="#" data-action="um_remove_modal" class="um-modal-close"><i class="um-faicon-times"></i></a>
	
	<div class="um-modal-body photo">
	
		<div class="um-modal-photo">

		</div>

	</div>
	
</div><script type='text/javascript'>
/* <![CDATA[ */
var _wpcom_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/themes/JustNews/js/main.js?ver=2.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/comment-reply.min.js?ver=4.8.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcom_qa_js = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","ajaxloading":"http:\/\/www.mottoin.com\/wp-content\/plugins\/wpcom-qa\/images\/loading.gif"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/wpcom-qa/js/scripts.min.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/imagesloaded.min.js?ver=3.2.0'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/masonry.min.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var um_scripts = {"ajaxurl":"http:\/\/www.mottoin.com\/wp-admin\/admin-ajax.php","fileupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-file-upload.php","imageupload":"http:\/\/www.mottoin.com\/wp-content\/plugins\/ultimate-member\/core\/lib\/upload\/um-image-upload.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/um.min.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-content/plugins/ultimate-member/assets/js/pickadate/translations/zh_CN.js?ver=10.3.88'></script>
<script type='text/javascript' src='http://www.mottoin.com/wp-includes/js/wp-embed.min.js?ver=4.8.1'></script>

		<script type="text/javascript">jQuery( '#request' ).val( '' );</script>

	    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","tsina","weixin","qzone","sqq","douban","fbook","twi","bdhome","tqq","tieba","mail","youdao","print"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":[{"tag" : "single", "bdSize" : 16}, {"tag" : "global","bdSize" : 16,bdPopupOffsetLeft:-227}],url:'http://www.mottoin.com/wp-content/themes/JustNews'};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://www.mottoin.com/wp-content/themes/JustNews/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</body>
</html>